/**
 * Cloudflare Containers + Durable Object deployment for this FastAPI backend.
 *
 * - Copy to wrangler.jsonc
 * - Replace the placeholders
 * - Use `wrangler secret put ...` for sensitive values (API keys)
 */
{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "ai-fullstack-backend",
  "main": "worker/index.ts",
  "compatibility_date": "2025-12-16",
  "ai": { "binding": "AI" },

  "containers": [
    {
      "class_name": "AgentBackend",
      // Either a local Dockerfile path (Wrangler will build it)...
      // "image": "./Dockerfile",
      // ...or a prebuilt image you pushed to Cloudflare's managed registry.
      // Example: "registry.cloudchamber.cfdata.org/ai-fullstack-backend:mirror"
      "image": "./Dockerfile",
      "max_instances": 3
    }
  ],

  "durable_objects": {
    "bindings": [{ "name": "AGENT_BACKEND", "class_name": "AgentBackend" }]
  },

  "migrations": [{ "tag": "v1", "new_sqlite_classes": ["AgentBackend"] }],

  "vars": {
    "OPENAI_BASE_URL": "https://www.right.codes/codex/v1",
    "LLM_PROVIDER": "openai",
    "SEARCH_PROVIDER": "autorag",
    "SEARCH_MODEL": "gpt-5.2",
    "OPENAI_API_KEY":"xxx",
    "AUTORAG_ID": "square-glade-783b",
    "AUTORAG_ENDPOINT": "https://ai.beqlee.icu/internal/autorag/search",
    "QUERY_GENERATOR_MODEL": "gpt-5.2",
    "ROLE_SELECTOR_MODEL": "gpt-5.2",
    "REFLECTION_MODEL": "gpt-5.2",
    "ANSWER_MODEL": "gpt-5.2",
    "DEBUG_OPENAI_RESPONSES": "1"
  },

  "observability": { "enabled": true }
}
